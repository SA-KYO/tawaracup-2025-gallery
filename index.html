<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind CSSï¼ˆCDNç‰ˆ â€»æœ¬ç•ªã§ã¯ãƒ“ãƒ«ãƒ‰æ¨å¥¨ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.08em;
    }
    /* å¤šå’Œæ¥½æ¯ãƒãƒƒã‚¸ã®ã‚­ãƒ©ãƒƒ âœ¨ */
    .tw-badge-shine {
      position: relative;
      overflow: hidden;
    }
    .tw-badge-shine::after {
      content: "";
      position: absolute;
      top: 0;
      left: -150%;
      width: 50%;
      height: 100%;
      background: linear-gradient(
        120deg,
        transparent 0%,
        rgba(255, 255, 255, 0.9) 50%,
        transparent 100%
      );
      animation: shine 1.6s infinite;
    }
    @keyframes shine {
      0%   { transform: translateX(0); opacity: 0; }
      35%  { opacity: 1; }
      100% { transform: translateX(350%); opacity: 0; }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-emerald-50 via-emerald-50/80 to-white min-h-screen">

  <main class="max-w-5xl mx-auto px-4 py-8 md:py-10">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="mb-6 md:mb-8">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-emerald-100 text-emerald-800 text-xs md:text-sm font-semibold tw-badge-shine shadow-sm">
        <span class="text-lg">ğŸŒï¸â€â™‚ï¸</span>
        <span>å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš</span>
      </div>

      <div class="mt-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
        <div>
          <h1 class="title-font text-2xl md:text-3xl font-bold text-slate-900">
            å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
          </h1>
          <p class="mt-1 text-sm md:text-base text-slate-600">
            ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆãŒä¸¦ã³ã¾ã™ã€‚
          </p>
        </div>

        <a
          href="https://tawaracup-2025-upload.netlify.app/"
          class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full border border-emerald-300 bg-white text-emerald-700 text-xs md:text-sm font-semibold shadow-sm hover:bg-emerald-50 transition"
        >
          â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚‹
        </a>
      </div>
    </header>

    <!-- ã‚¿ãƒ– & èª¬æ˜ã‚«ãƒ¼ãƒ‰ -->
    <section class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg border border-emerald-100 p-4 md:p-6 mb-6 md:mb-8">
      <!-- ã‚¿ãƒ– -->
      <div class="flex justify-center mb-4">
        <div class="inline-flex rounded-full bg-emerald-50 p-1">
          <button
            id="tabPhotos"
            class="tab-btn inline-flex items-center gap-1 px-6 py-2 rounded-full text-sm font-semibold bg-emerald-600 text-white shadow-sm"
            data-tab="photos"
          >
            <span class="text-lg">ğŸ“¸</span>
            <span>å†™çœŸ</span>
          </button>
          <button
            id="tabVideos"
            class="tab-btn inline-flex items-center gap-1 px-6 py-2 rounded-full text-sm font-semibold text-emerald-700"
            data-tab="videos"
          >
            <span class="text-lg">ğŸ¬</span>
            <span>å‹•ç”»</span>
          </button>
        </div>
      </div>

      <!-- èª¬æ˜æ–‡ï¼ˆã‚¹ãƒãƒ›ãƒ¡ã‚¤ãƒ³ï¼‰ -->
      <div class="text-xs md:text-sm text-slate-600 space-y-1 leading-relaxed">
        <p>
          ã‚¹ãƒãƒ›ï¼šã‚µãƒ ãƒã‚¤ãƒ« ã¾ãŸã¯ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€å†™çœŸï¼å‹•ç”»ãŒåˆ¥ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚
          ãã®ç”»é¢ã‚’ <span class="font-semibold">é•·æŠ¼ã—</span> ã—ã¦
          <span class="font-semibold">ã€Œå†™çœŸã«ä¿å­˜ã€ï¼ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€</span> ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
        </p>
        <p class="text-[11px] md:text-xs text-slate-500">
          â€»LINEã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã€Œâ€¦ã€â†’ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€ãŒå‡ºãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
          ãã®ã¨ãã¯ã€å³ä¸‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰
          <span class="font-semibold">ã€ŒSafariã§é–‹ãã€â†’ å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ï¼ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã€</span>
          ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚
        </p>
      </div>
    </section>

    <!-- å†™çœŸä¸€è¦§ -->
    <section id="sectionPhotos">
      <div class="flex items-center gap-2 mb-3 md:mb-4">
        <span class="text-xl">ğŸ“·</span>
        <h2 class="text-lg md:text-xl font-semibold text-slate-900">å†™çœŸä¸€è¦§</h2>
      </div>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        æ°—ã«å…¥ã£ãŸå†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å¤§ããè¡¨ç¤ºã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰åŒã˜ç”»é¢ã‚’é–‹ã‘ã¾ã™ã€‚
      </p>

      <div id="photoList" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
        <!-- å†™çœŸã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
      </div>
      <p id="photoMessage" class="mt-4 text-center text-xs md:text-sm text-slate-500"></p>
    </section>

    <!-- å‹•ç”»ä¸€è¦§ -->
    <section id="sectionVideos" class="hidden">
      <div class="flex items-center gap-2 mb-3 md:mb-4">
        <span class="text-xl">ğŸ¥</span>
        <h2 class="text-lg md:text-xl font-semibold text-slate-900">å‹•ç”»ä¸€è¦§</h2>
      </div>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        å¥½ããªå‹•ç”»ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å†ç”Ÿã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™
        ï¼ˆiPhoneã§ã¯â€œãƒ•ã‚¡ã‚¤ãƒ«â€ã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ï¼‰ã€‚
      </p>

      <div id="videoList" class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
        <!-- å‹•ç”»ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
      </div>
      <p id="videoMessage" class="mt-4 text-center text-xs md:text-sm text-slate-500"></p>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="mt-10 md:mt-12 text-center text-[11px] md:text-xs text-slate-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </main>

  <script>
    // ===== Cloudinary è¨­å®š =====
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    const PHOTO_LIST_URL = `https://res.cloudinary.com/${CLOUD_NAME}/image/list/${TAG}.json`;
    const VIDEO_LIST_URL = `https://res.cloudinary.com/${CLOUD_NAME}/video/list/${TAG}.json`;

    // ===== DOM å–å¾— =====
    const tabPhotos = document.getElementById("tabPhotos");
    const tabVideos = document.getElementById("tabVideos");
    const sectionPhotos = document.getElementById("sectionPhotos");
    const sectionVideos = document.getElementById("sectionVideos");

    const photoListEl = document.getElementById("photoList");
    const videoListEl = document.getElementById("videoList");
    const photoMessageEl = document.getElementById("photoMessage");
    const videoMessageEl = document.getElementById("videoMessage");

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    let photoLoaded = false;
    let videoLoaded = false;
    let photoCache = [];
    let videoCache = [];

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    function setActiveTab(tab) {
      if (tab === "photos") {
        tabPhotos.classList.add("bg-emerald-600", "text-white", "shadow-sm");
        tabPhotos.classList.remove("text-emerald-700");
        tabVideos.classList.remove("bg-emerald-600", "text-white", "shadow-sm");
        tabVideos.classList.add("text-emerald-700");

        sectionPhotos.classList.remove("hidden");
        sectionVideos.classList.add("hidden");

        if (!photoLoaded) loadPhotos();
      } else {
        tabVideos.classList.add("bg-emerald-600", "text-white", "shadow-sm");
        tabVideos.classList.remove("text-emerald-700");
        tabPhotos.classList.remove("bg-emerald-600", "text-white", "shadow-sm");
        tabPhotos.classList.add("text-emerald-700");

        sectionVideos.classList.remove("hidden");
        sectionPhotos.classList.add("hidden");

        if (!videoLoaded) loadVideos();
      }
    }

    tabPhotos.addEventListener("click", () => setActiveTab("photos"));
    tabVideos.addEventListener("click", () => setActiveTab("videos"));

    // åˆæœŸè¡¨ç¤ºã¯å†™çœŸ
    setActiveTab("photos");

    // ===== Utility: åå‰ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆå–å¾— =====
    function getCaption(item) {
      // context.custom.caption ã« URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸåå‰ãŒå…¥ã£ã¦ã„ã‚‹æƒ³å®š
      try {
        const raw = item?.context?.custom?.caption || "";
        return raw ? decodeURIComponent(raw) : "";
      } catch {
        return item?.context?.custom?.caption || "";
      }
    }

    function getComment(item) {
      // context.custom.alt ã« URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆãŒå…¥ã£ã¦ã„ã‚‹æƒ³å®š
      try {
        const raw = item?.context?.custom?.alt || "";
        return raw ? decodeURIComponent(raw) : "";
      } catch {
        return item?.context?.custom?.alt || "";
      }
    }

    // ===== å†™çœŸèª­ã¿è¾¼ã¿ =====
    async function loadPhotos() {
      photoMessageEl.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
      photoListEl.innerHTML = "";

      try {
        const res = await fetch(PHOTO_LIST_URL);
        if (!res.ok) throw new Error("failed");
        const data = await res.json();

        const resources = data.resources || data || [];
        photoCache = resources;
        photoLoaded = true;

        if (!resources.length) {
          photoMessageEl.textContent = "ã¾ã å†™çœŸãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
          return;
        }

        photoMessageEl.textContent = "";
        renderPhotos(resources);
      } catch (e) {
        console.error(e);
        photoMessageEl.textContent = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    function renderPhotos(items) {
      photoListEl.innerHTML = "";

      items.forEach((item, index) => {
        const imageUrl = item.secure_url;
        if (!imageUrl) return;

        const name = getCaption(item) || "ã‚²ã‚¹ãƒˆ";
        const comment = getComment(item);

        const card = document.createElement("article");
        card.className =
          "bg-white rounded-2xl shadow-sm border border-emerald-50 overflow-hidden flex flex-col";

        // ã‚µãƒ ãƒã‚¤ãƒ«
        const thumbBtn = document.createElement("button");
        thumbBtn.type = "button";
        thumbBtn.className = "relative w-full pt-[75%] overflow-hidden bg-slate-100";
        const img = document.createElement("img");
        img.src = imageUrl;
        img.alt = comment || name || `photo-${index + 1}`;
        img.loading = "lazy";
        img.className = "absolute inset-0 w-full h-full object-cover";
        thumbBtn.appendChild(img);

        thumbBtn.addEventListener("click", () => {
          window.open(imageUrl, "_blank");
        });

        // ãƒ†ã‚­ã‚¹ãƒˆéƒ¨
        const body = document.createElement("div");
        body.className = "px-3 pt-2 pb-3 flex flex-col gap-1";

        const nameEl = document.createElement("p");
        nameEl.className = "text-xs font-semibold text-slate-800 truncate";
        nameEl.textContent = name;

        const commentEl = document.createElement("p");
        commentEl.className = "text-[11px] text-slate-500 line-clamp-2 min-h-[1.5em]";
        commentEl.textContent = comment || "";

        // ãƒœã‚¿ãƒ³
        const btnWrapper = document.createElement("div");
        btnWrapper.className = "mt-2";

        const openBtn = document.createElement("button");
        openBtn.type = "button";
        openBtn.className =
          "w-full inline-flex items-center justify-center gap-1 rounded-full bg-emerald-50 text-emerald-800 text-xs font-semibold py-1.5 hover:bg-emerald-100 transition";
        openBtn.innerHTML = "â†“ <span>é–‹ã„ã¦ä¿å­˜</span>";

        // å†™çœŸã¯æ—¢å­˜ã©ãŠã‚Šï¼šåˆ¥ã‚¿ãƒ–ã§é–‹ã â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé•·æŠ¼ã—ä¿å­˜
        openBtn.addEventListener("click", () => {
          window.open(imageUrl, "_blank");
        });

        btnWrapper.appendChild(openBtn);
        body.appendChild(nameEl);
        body.appendChild(commentEl);
        body.appendChild(btnWrapper);

        card.appendChild(thumbBtn);
        card.appendChild(body);

        photoListEl.appendChild(card);
      });
    }

    // ===== å‹•ç”»èª­ã¿è¾¼ã¿ =====
    async function loadVideos() {
      videoMessageEl.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
      videoListEl.innerHTML = "";

      try {
        const res = await fetch(VIDEO_LIST_URL);
        if (!res.ok) throw new Error("failed");
        const data = await res.json();

        const resources = data.resources || data || [];
        videoCache = resources;
        videoLoaded = true;

        if (!resources.length) {
          videoMessageEl.textContent = "ã¾ã å‹•ç”»ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
          return;
        }

        videoMessageEl.textContent = "";
        renderVideos(resources);
      } catch (e) {
        console.error(e);
        videoMessageEl.textContent = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    function renderVideos(items) {
      videoListEl.innerHTML = "";

      items.forEach((item, index) => {
        const videoUrl = item.secure_url;
        if (!videoUrl) return;

        const name = getCaption(item) || "ã‚²ã‚¹ãƒˆ";
        const comment = getComment(item);

        const card = document.createElement("article");
        card.className =
          "bg-white rounded-2xl shadow-sm border border-emerald-50 overflow-hidden flex flex-col";

        // ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆå‹•ç”»ï¼‰
        const thumbBtn = document.createElement("button");
        thumbBtn.type = "button";
        thumbBtn.className = "relative w-full pt-[75%] overflow-hidden bg-black";

        const videoThumb = document.createElement("video");
        videoThumb.src = videoUrl;
        videoThumb.className = "absolute inset-0 w-full h-full object-cover";
        videoThumb.muted = true;
        videoThumb.playsInline = true;
        videoThumb.preload = "metadata";
        thumbBtn.appendChild(videoThumb);

        const playIcon = document.createElement("div");
        playIcon.className =
          "absolute inset-0 flex items-center justify-center pointer-events-none";
        playIcon.innerHTML =
          '<div class="w-12 h-12 rounded-full bg-black/60 flex items-center justify-center text-white text-xl">â–¶ï¸</div>';
        thumbBtn.appendChild(playIcon);

        // ã‚µãƒ ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒ— â†’ åˆ¥ã‚¿ãƒ–ã§å†ç”Ÿï¼ˆæ—¢å­˜ä»•æ§˜ï¼‰
        thumbBtn.addEventListener("click", () => {
          window.open(videoUrl, "_blank");
        });

        // ãƒ†ã‚­ã‚¹ãƒˆéƒ¨
        const body = document.createElement("div");
        body.className = "px-3 pt-2 pb-3 flex flex-col gap-1";

        const nameEl = document.createElement("p");
        nameEl.className = "text-xs font-semibold text-slate-800 truncate";
        nameEl.textContent = name;

        const commentEl = document.createElement("p");
        commentEl.className = "text-[11px] text-slate-500 line-clamp-2 min-h-[1.5em]";
        commentEl.textContent = comment || "";

        // ãƒœã‚¿ãƒ³ï¼ˆâ˜…ã“ã“ã ã‘ä»Šå›ã®ä¿®æ­£â˜…ï¼‰
        const btnWrapper = document.createElement("div");
        btnWrapper.className = "mt-2";

        const openBtn = document.createElement("button");
        openBtn.type = "button";
        openBtn.className =
          "w-full inline-flex items-center justify-center gap-1 rounded-full bg-emerald-50 text-emerald-800 text-xs font-semibold py-1.5 hover:bg-emerald-100 transition";
        openBtn.innerHTML = "â†“ <span>é–‹ã„ã¦ä¿å­˜</span>";

        // â˜… å‹•ç”»å°‚ç”¨ï¼šã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰è¦æ±‚ã‚’å‡ºã™
        openBtn.addEventListener("click", async () => {
          const baseName = (item.public_id || "").split("/").pop() || "video";
          const fileName = `${baseName}.${item.format || "mp4"}`;

          try {
            // Cloudinary ã‹ã‚‰å‹•ç”»ã‚’ blob ã¨ã—ã¦å–å¾—
            const response = await fetch(videoUrl);
            if (!response.ok) throw new Error("download failed");
            const blob = await response.blob();

            // blob URL ã‚’ä½œã£ã¦ download å±æ€§ä»˜ããƒªãƒ³ã‚¯ã§ã‚¯ãƒªãƒƒã‚¯
            const blobUrl = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = blobUrl;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            // å¾Œç‰‡ä»˜ã‘
            setTimeout(() => {
              window.URL.revokeObjectURL(blobUrl);
            }, 10000);
          } catch (err) {
            console.error("download error", err);
            // å¤±æ•—æ™‚ã¯ã“ã‚Œã¾ã§é€šã‚Šåˆ¥ã‚¿ãƒ–å†ç”Ÿã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            window.open(videoUrl, "_blank");
          }
        });

        btnWrapper.appendChild(openBtn);
        body.appendChild(nameEl);
        body.appendChild(commentEl);
        body.appendChild(btnWrapper);

        card.appendChild(thumbBtn);
        card.appendChild(body);

        videoListEl.appendChild(card);
      });
    }
  </script>
</body>
</html>
