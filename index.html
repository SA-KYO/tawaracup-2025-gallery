<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #fff7ff 0, #f3e8ff 30%, #f9fafb 70%);
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.08em;
    }
    .fade-in {
      animation: fade-in 0.4s ease-out;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen px-4 py-6">
  <div class="max-w-5xl mx-auto">

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="flex items-center justify-between mb-4">
      <div>
        <h1 class="title-font text-xl md:text-2xl font-bold text-purple-700">
          å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼
        </h1>
        <p class="text-xs md:text-sm text-gray-600 mt-1">
          ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸå†™çœŸãƒ»å‹•ç”»ãŒã€è‡ªå‹•ã§ã“ã“ã«ä¸¦ã³ã¾ã™ã€‚
        </p>
      </div>
      <a
        href="https://tawaracup-2025-photo.netlify.app/"
        class="text-xs md:text-sm text-purple-700 border border-purple-300 rounded-full px-3 py-1 hover:bg-purple-50 transition"
      >
        â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚‹
      </a>
    </header>

    <!-- ä¿å­˜æ–¹æ³•ã®æ¡ˆå†… -->
    <div class="mb-4 bg-white/80 border border-purple-100 rounded-2xl px-4 py-3 shadow-sm flex items-start gap-2 text-xs md:text-sm text-gray-600">
      <span class="mt-0.5 text-green-500">âœ…</span>
      <div>
        <div class="font-semibold text-purple-700 mb-0.5">å†™çœŸãƒ»å‹•ç”»ã®ä¿å­˜æ–¹æ³•</div>
        <p>
          ã‚¹ãƒãƒ›ï¼šãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§è¡¨ç¤ºã•ã‚ŒãŸå†™çœŸãƒ»å‹•ç”»ã‚’
          <strong>é•·æŠ¼ã—</strong>ã—ã¦ã€Œå†™çœŸã«è¿½åŠ ã€ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€ãªã©ã‚’é¸æŠ<br>
          PCï¼šç”»åƒãƒ»å‹•ç”»ã‚’é–‹ã„ãŸçŠ¶æ…‹ã§å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€
        </p>
      </div>
    </div>

    <!-- ã‚¿ãƒ– -->
    <div class="mb-4 flex gap-2">
      <button
        id="tab-images"
        class="flex-1 text-sm md:text-base rounded-full px-4 py-2 font-medium bg-purple-600 text-white shadow-md hover:bg-purple-700 transition border border-transparent"
        data-type="image"
      >
        ğŸ“· å†™çœŸ
      </button>
      <button
        id="tab-videos"
        class="flex-1 text-sm md:text-base rounded-full px-4 py-2 font-medium bg-white text-purple-700 border border-purple-200 hover:bg-purple-50 transition"
        data-type="video"
      >
        ğŸ¥ å‹•ç”»
      </button>
    </div>

    <!-- ã‚°ãƒªãƒƒãƒ‰æœ¬ä½“ -->
    <section id="gallery-section" class="bg-white/80 rounded-3xl shadow-lg p-3 md:p-4 min-h-[200px]">
      <div id="loading" class="text-center text-gray-500 text-sm py-10">
        èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦
      </div>

      <div id="empty" class="hidden text-center text-gray-400 text-sm py-10">
        ã¾ã ã“ã®ã‚¿ãƒ–ã«ã¯ãƒ¡ãƒ‡ã‚£ã‚¢ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
      </div>

      <div
        id="grid"
        class="hidden grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 fade-in"
      >
        <!-- JS ã§ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ  -->
      </div>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="mt-6 text-center text-[11px] text-gray-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </div>

  <!-- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤ºç”¨ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
  <div
    id="lightbox"
    class="fixed inset-0 bg-black/70 flex items-center justify-center z-40 px-3 py-8 hidden"
  >
    <div class="relative max-w-3xl w-full max-h-full flex items-center justify-center">
      <!-- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ -->
      <button
        id="lightbox-close"
        class="absolute -top-8 right-0 text-white/80 hover:text-white text-2xl"
        aria-label="é–‰ã˜ã‚‹"
      >
        Ã—
      </button>

      <!-- ä¸­èº« -->
      <div id="lightbox-content" class="w-full max-h-[80vh] flex items-center justify-center"></div>
    </div>
  </div>

  <script>
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    const tabImages = document.getElementById("tab-images");
    const tabVideos = document.getElementById("tab-videos");
    const loadingEl = document.getElementById("loading");
    const emptyEl = document.getElementById("empty");
    const gridEl = document.getElementById("grid");

    const lightbox = document.getElementById("lightbox");
    const lightboxContent = document.getElementById("lightbox-content");
    const lightboxClose = document.getElementById("lightbox-close");

    let cache = {
      image: null,
      video: null,
    };

    function setActiveTab(type) {
      const activeClasses = ["bg-purple-600","text-white","shadow-md","border-transparent"];
      const inactiveClasses = ["bg-white","text-purple-700","border","border-purple-200","shadow-none"];

      if (type === "image") {
        tabImages.classList.remove(...inactiveClasses);
        tabVideos.classList.remove(...activeClasses);
        tabImages.classList.add(...activeClasses);
        tabVideos.classList.add(...inactiveClasses);
      } else {
        tabVideos.classList.remove(...inactiveClasses);
        tabImages.classList.remove(...activeClasses);
        tabVideos.classList.add(...activeClasses);
        tabImages.classList.add(...inactiveClasses);
      }
    }

    function openLightboxForImage(url, alt) {
      lightboxContent.innerHTML = `
        <img src="${url}" alt="${alt || ''}"
          class="max-h-[80vh] w-auto rounded-2xl shadow-2xl object-contain bg-black" />
      `;
      lightbox.classList.remove("hidden");
    }

    function openLightboxForVideo(url) {
      lightboxContent.innerHTML = `
        <video src="${url}" controls autoplay playsinline
          class="max-h-[80vh] w-auto rounded-2xl shadow-2xl bg-black object-contain"></video>
      `;
      lightbox.classList.remove("hidden");
    }

    function closeLightbox() {
      lightbox.classList.add("hidden");
      lightboxContent.innerHTML = "";
    }

    lightboxClose.addEventListener("click", closeLightbox);
    lightbox.addEventListener("click", (e) => {
      // é»’èƒŒæ™¯ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹ï¼ˆä¸­èº«ã®ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡è¦–ï¼‰
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    function createImageCard(resource) {
      const publicId = resource.public_id;
      const format = resource.format;
      const secureUrl = resource.secure_url;
      const thumbUrl =
        "https://res.cloudinary.com/" +
        CLOUD_NAME +
        "/image/upload/c_fill,w_800,h_800,q_auto,f_auto/" +
        publicId +
        "." +
        format;
      const fileName = publicId.split("/").pop();

      const card = document.createElement("div");
      card.className =
        "relative group overflow-hidden rounded-2xl bg-gray-50 shadow-sm hover:shadow-md transition cursor-pointer";
      card.dataset.type = "image";
      card.dataset.url = secureUrl;
      card.dataset.alt = fileName;

      card.innerHTML = `
        <img
          src="${thumbUrl}"
          alt="${fileName}"
          class="w-full h-40 md:h-44 object-cover transition-transform duration-300 group-hover:scale-105"
        />
        <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-[10px] text-white px-2 py-1 flex items-center justify-between gap-1 opacity-0 group-hover:opacity-100 transition">
          <span class="truncate">ğŸ“· ${fileName}</span>
          <a
            href="${secureUrl}"
            download="${fileName}"
            class="px-2 py-0.5 rounded-full bg-white/80 text-[10px] text-purple-700 font-semibold hover:bg-white"
          >
            â†“ ä¿å­˜
          </a>
        </div>
      `;

      // ä¿å­˜ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã¯ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒƒã‚¯ã¨åˆ†é›¢
      const dl = card.querySelector("a");
      dl.addEventListener("click", (e) => e.stopPropagation());

      card.addEventListener("click", () => {
        openLightboxForImage(secureUrl, fileName);
      });

      return card;
    }

    function createVideoCard(resource) {
      const publicId = resource.public_id;
      const format = resource.format;
      const secureUrl = resource.secure_url;
      const fileName = publicId.split("/").pop();

      const posterUrl =
        "https://res.cloudinary.com/" +
        CLOUD_NAME +
        "/video/upload/so_0,du_1,c_fill,w_800,h_800,q_auto,f_auto/" +
        publicId +
        "." +
        format;

      const card = document.createElement("div");
      card.className =
        "relative group overflow-hidden rounded-2xl bg-gray-50 shadow-sm hover:shadow-md transition cursor-pointer";
      card.dataset.type = "video";
      card.dataset.url = secureUrl;

      card.innerHTML = `
        <div class="relative">
          <img
            src="${posterUrl}"
            alt="${fileName}"
            class="w-full h-40 md:h-44 object-cover"
          />
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-black/60 flex items-center justify-center">
              <div class="w-0 h-0 border-t-6 border-b-6 border-l-8 md:border-t-8 md:border-b-8 md:border-l-12 border-t-transparent border-b-transparent border-l-white ml-1"></div>
            </div>
          </div>
        </div>
        <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent text-[10px] text-white px-2 py-1 flex items-center justify-between gap-1 opacity-0 group-hover:opacity-100 transition">
          <span class="truncate">ğŸ¥ ${fileName}</span>
          <a
            href="${secureUrl}"
            download="${fileName}"
            class="px-2 py-0.5 rounded-full bg-white/80 text-[10px] text-purple-700 font-semibold hover:bg-white"
          >
            â†“ ä¿å­˜
          </a>
        </div>
      `;

      const dl = card.querySelector("a");
      dl.addEventListener("click", (e) => e.stopPropagation());

      card.addEventListener("click", () => {
        openLightboxForVideo(secureUrl);
      });

      return card;
    }

    async function loadMedia(type) {
      setActiveTab(type);
      loadingEl.classList.remove("hidden");
      emptyEl.classList.add("hidden");
      gridEl.classList.add("hidden");
      gridEl.innerHTML = "";

      try {
        let resources = cache[type];
        if (!resources) {
          const url = `https://res.cloudinary.com/${CLOUD_NAME}/${type}/list/${TAG}.json`;
          const res = await fetch(url);
          if (!res.ok) throw new Error("failed to fetch");
          const data = await res.json();
          resources = data.resources || [];
          cache[type] = resources;
        }

        loadingEl.classList.add("hidden");

        if (!resources.length) {
          emptyEl.classList.remove("hidden");
          gridEl.classList.add("hidden");
          return;
        }

        resources.forEach((r) => {
          const card =
            type === "image" ? createImageCard(r) : createVideoCard(r);
          gridEl.appendChild(card);
        });

        emptyEl.classList.add("hidden");
        gridEl.classList.remove("hidden");
      } catch (e) {
        console.error(e);
        loadingEl.textContent =
          "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    tabImages.addEventListener("click", () => loadMedia("image"));
    tabVideos.addEventListener("click", () => loadMedia("video"));

    // åˆæœŸè¡¨ç¤ºã¯å†™çœŸã‚¿ãƒ–
    loadMedia("image");
  </script>
</body>
</html>
