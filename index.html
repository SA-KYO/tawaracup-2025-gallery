<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.06em;
    }
    /* ã€Œå¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒšã€ãƒãƒƒã‚¸ã®ã‚­ãƒ©ãƒƒ */
    @keyframes twinkle {
      0%, 90% { box-shadow: 0 0 0 rgba(251, 191, 36, 0); }
      95% { box-shadow: 0 0 18px rgba(251, 191, 36, 0.8); }
      100% { box-shadow: 0 0 0 rgba(251, 191, 36, 0); }
    }
    .twinkle-badge {
      animation: twinkle 1.2s infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-emerald-50 via-emerald-50 to-emerald-100 min-h-screen">

  <main class="max-w-5xl mx-auto px-4 py-8 md:py-12">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="mb-6 md:mb-8">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/80 border border-emerald-200 shadow-sm twinkle-badge">
        <span class="text-xl">â›³ï¸</span>
        <span class="text-xs md:text-sm font-semibold text-emerald-700">
          å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš
        </span>
      </div>

      <h1 class="title-font text-2xl md:text-3xl font-extrabold text-slate-900 mt-4 mb-2">
        å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
      </h1>
      <p class="text-sm md:text-base text-slate-600">
        ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆãŒä¸¦ã³ã¾ã™ã€‚
      </p>

      <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã¸æˆ»ã‚‹ -->
      <div class="mt-4">
        <a
          href="https://tawaracup-2025-photo.netlify.app/"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-full border border-emerald-300 bg-white/80 text-emerald-700 text-xs md:text-sm font-semibold shadow-sm hover:bg-emerald-50 transition"
        >
          â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚‹
        </a>
      </div>
    </header>

    <!-- èª¬æ˜ & ã‚¿ãƒ– -->
    <section class="bg-white/90 backdrop-blur-sm rounded-3xl border border-emerald-100 shadow-md px-4 py-4 md:px-6 md:py-5 mb-6 md:mb-8">
      <!-- ã‚¿ãƒ– -->
      <div class="flex items-center gap-3 mb-4">
        <div class="inline-flex bg-emerald-50 rounded-full p-1">
          <button
            id="tab-photos"
            type="button"
            class="tab-button flex-1 inline-flex items-center justify-center gap-2 px-4 py-1.5 text-xs md:text-sm font-semibold rounded-full bg-white shadow-sm text-emerald-700"
            data-tab="photos"
          >
            <span>ğŸ“·</span><span>å†™çœŸ</span>
          </button>
          <button
            id="tab-videos"
            type="button"
            class="tab-button flex-1 inline-flex items-center justify-center gap-2 px-4 py-1.5 text-xs md:text-sm font-semibold rounded-full text-emerald-600"
            data-tab="videos"
          >
            <span>ğŸ¥</span><span>å‹•ç”»</span>
          </button>
        </div>
      </div>

      <!-- ã‚¹ãƒãƒ›ç”¨ã®ä¿å­˜èª¬æ˜ã ã‘æ®‹ã™ -->
      <p class="text-xs md:text-sm text-slate-600 leading-relaxed">
        ã‚¹ãƒãƒ›ï¼š<span class="font-semibold">ã‚µãƒ ãƒã‚¤ãƒ«</span> ã¾ãŸã¯
        <span class="font-semibold">ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€</span> ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ç”»åƒï¼å‹•ç”»ãŒåˆ¥ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚
        ãã“ã§ <span class="font-semibold">é•·æŠ¼ã— â†’ã€Œå†™çœŸã«ä¿å­˜ã€ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€</span> ãªã©ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
      </p>
    </section>

    <!-- å†™çœŸãƒªã‚¹ãƒˆ -->
    <section id="photos-section" class="mb-10">
      <h2 class="flex items-center gap-2 text-base md:text-lg font-bold text-slate-800 mb-3">
        <span>ğŸ“¸</span><span>å†™çœŸä¸€è¦§</span>
      </h2>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        æ°—ã«å…¥ã£ãŸå†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å¤§ããè¡¨ç¤ºã§ãã¾ã™ã€‚
        ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰ã‚‚åŒã˜ç”»é¢ã‚’é–‹ã‘ã¾ã™ã€‚
      </p>
      <div id="photos-container" class="min-h-[3rem] flex items-center justify-center text-sm text-slate-500">
        èª­ã¿è¾¼ã¿ä¸­â€¦
      </div>
    </section>

    <!-- å‹•ç”»ãƒªã‚¹ãƒˆ -->
    <section id="videos-section" class="mb-4 hidden">
      <h2 class="flex items-center gap-2 text-base md:text-lg font-bold text-slate-800 mb-3">
        <span>ğŸ¬</span><span>å‹•ç”»ä¸€è¦§</span>
      </h2>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        æ°—ã«å…¥ã£ãŸå‹•ç”»ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å†ç”Ÿã§ãã¾ã™ã€‚
        ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰ã‚‚åŒã˜ç”»é¢ã‚’é–‹ã‘ã¾ã™ã€‚
      </p>
      <div id="videos-container" class="min-h-[3rem] flex items-center justify-center text-sm text-slate-500">
        èª­ã¿è¾¼ã¿ä¸­â€¦
      </div>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="pt-4 pb-2 text-center text-[11px] text-slate-500">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </main>

  <script>
    // ====== Cloudinary è¨­å®š ======
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025"; // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å´ã§ä»˜ã‘ã¦ã„ã‚‹ã‚¿ã‚°

    const photosContainer = document.getElementById("photos-container");
    const videosContainer = document.getElementById("videos-container");
    const photosSection = document.getElementById("photos-section");
    const videosSection = document.getElementById("videos-section");

    const tabButtons = document.querySelectorAll(".tab-button");

    const state = {
      photos: [],
      videos: [],
      loaded: false
    };

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(str) {
      if (!str) return "";
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã« encodeURIComponent ã—ãŸå€¤ã‚’æˆ»ã™
    function decodeMeta(value) {
      if (!value) return "";
      try {
        return decodeURIComponent(value);
      } catch (e) {
        return value;
      }
    }

    // ç”»åƒã®æœ¬ç•ªURLãƒ»ã‚µãƒ ãƒã‚¤ãƒ«URL
    function buildImageUrl(resource, w) {
      const format = resource.format || "jpg";
      const width = w || 1200; // å¤§ãã‚
      return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/q_auto,f_auto,w_${width}/${resource.public_id}.${format}`;
    }

    // å‹•ç”»ã®æœ¬ç•ªURLãƒ»ã‚µãƒ ãƒã‚¤ãƒ«URL
    function buildVideoUrl(resource) {
      const format = resource.format || "mp4";
      return `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/q_auto/${resource.public_id}.${format}`;
    }

    function buildVideoThumbUrl(resource) {
      // å‹•ç”»ã®1ãƒ•ãƒ¬ãƒ¼ãƒ ç›®ã‚’ã‚µãƒ ãƒã‚¤ãƒ«é™æ­¢ç”»ã«ã™ã‚‹
      return `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/so_1,q_auto,f_auto,w_600/${resource.public_id}.jpg`;
    }

    function openInNewTab(url) {
      // iOS Safari / LINE å†…ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã„ã¦
      // ãã“ã§é•·æŠ¼ã— or å…±æœ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ä¿å­˜ã—ã¦ã‚‚ã‚‰ã†
      window.open(url, "_blank");
    }

    // ====== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ======

    function renderPhotos() {
      const list = state.photos;
      if (!list || list.length === 0) {
        photosContainer.className = "py-6 text-center text-sm text-slate-500";
        photosContainer.innerHTML = "ã¾ã å†™çœŸãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        return;
      }

      photosContainer.className = "grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4";

      photosContainer.innerHTML = "";
      list.forEach((res) => {
        const name = decodeMeta(res.context?.custom?.caption || "");
        const comment = decodeMeta(res.context?.custom?.alt || "");

        const thumbUrl = buildImageUrl(res, 600);
        const fullUrl = buildImageUrl(res, 1400);

        const card = document.createElement("article");
        card.className = "bg-white/90 border border-emerald-100 rounded-2xl shadow-sm overflow-hidden flex flex-col";

        card.innerHTML = `
          <button type="button" class="relative aspect-[4/5] overflow-hidden group">
            <img
              src="${thumbUrl}"
              alt="${escapeHtml(comment || name || 'ã‚³ãƒ³ãƒšå†™çœŸ')}"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
            />
          </button>
          <div class="px-3 pt-2 pb-3 border-t border-emerald-50 text-[11px] md:text-xs text-slate-700">
            ${
              name
                ? `<p class="font-semibold text-slate-800 truncate">${escapeHtml(
                    name
                  )}</p>`
                : ""
            }
            ${
              comment
                ? `<p class="mt-0.5 line-clamp-2">${escapeHtml(comment)}</p>`
                : ""
            }
          </div>
          <button
            type="button"
            class="mx-3 mb-3 mt-0 py-1.5 text-[11px] md:text-xs font-semibold rounded-full bg-emerald-50 text-emerald-700 hover:bg-emerald-100 transition flex items-center justify-center gap-1"
          >
            <span>â†“</span><span>é–‹ã„ã¦ä¿å­˜</span>
          </button>
        `;

        // ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ã‚¿ãƒƒãƒ— â†’ ç”»åƒã‚¿ãƒ–ã§é–‹ã
        const thumbBtn = card.querySelector("button");
        thumbBtn.addEventListener("click", () => openInNewTab(fullUrl));

        // ã€Œé–‹ã„ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³ â†’ åŒã˜ãé–‹ã
        const saveBtn = card.querySelectorAll("button")[1];
        saveBtn.addEventListener("click", () => openInNewTab(fullUrl));

        photosContainer.appendChild(card);
      });
    }

    function renderVideos() {
      const list = state.videos;
      if (!list || list.length === 0) {
        videosContainer.className = "py-6 text-center text-sm text-slate-500";
        videosContainer.innerHTML = "ã¾ã å‹•ç”»ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        return;
      }

      videosContainer.className = "grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4";

      videosContainer.innerHTML = "";
      list.forEach((res) => {
        const name = decodeMeta(res.context?.custom?.caption || "");
        const comment = decodeMeta(res.context?.custom?.alt || "");

        const thumbUrl = buildVideoThumbUrl(res);
        const videoUrl = buildVideoUrl(res);

        const card = document.createElement("article");
        card.className = "bg-white/90 border border-emerald-100 rounded-2xl shadow-sm overflow-hidden flex flex-col";

        card.innerHTML = `
          <button type="button" class="relative aspect-video overflow-hidden group">
            <img
              src="${thumbUrl}"
              alt="${escapeHtml(comment || name || 'ã‚³ãƒ³ãƒšå‹•ç”»')}"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
            />
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-black/60 flex items-center justify-center">
                <span class="text-white text-lg md:text-xl">â–¶</span>
              </div>
            </div>
          </button>
          <div class="px-3 pt-2 pb-3 border-t border-emerald-50 text-[11px] md:text-xs text-slate-700">
            ${
              name
                ? `<p class="font-semibold text-slate-800 truncate">${escapeHtml(
                    name
                  )}</p>`
                : ""
            }
            ${
              comment
                ? `<p class="mt-0.5 line-clamp-2">${escapeHtml(comment)}</p>`
                : ""
            }
          </div>
          <button
            type="button"
            class="mx-3 mb-3 mt-0 py-1.5 text-[11px] md:text-xs font-semibold rounded-full bg-emerald-50 text-emerald-700 hover:bg-emerald-100 transition flex items-center justify-center gap-1"
          >
            <span>â†“</span><span>é–‹ã„ã¦ä¿å­˜</span>
          </button>
        `;

        const thumbBtn = card.querySelector("button");
        thumbBtn.addEventListener("click", () => openInNewTab(videoUrl));

        const saveBtn = card.querySelectorAll("button")[1];
        saveBtn.addEventListener("click", () => openInNewTab(videoUrl));

        videosContainer.appendChild(card);
      });
    }

    // ====== ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ======
    async function loadAssetsOnce() {
      if (state.loaded) {
        return;
      }
      try {
        // ç”»åƒã¨å‹•ç”»ã‚’åŒæ™‚ã«å–å¾—
        const [imgRes, vidRes] = await Promise.all([
          fetch(`https://res.cloudinary.com/${CLOUD_NAME}/image/list/${TAG}.json`),
          fetch(`https://res.cloudinary.com/${CLOUD_NAME}/video/list/${TAG}.json`)
        ]);

        const imgJson = imgRes.ok ? await imgRes.json() : { resources: [] };
        const vidJson = vidRes.ok ? await vidRes.json() : { resources: [] };

        state.photos = imgJson.resources || [];
        state.videos = vidJson.resources || [];
        state.loaded = true;

        renderPhotos();
        renderVideos();
      } catch (e) {
        console.error("Load error:", e);
        photosContainer.className = "py-6 text-center text-sm text-red-500";
        photosContainer.textContent = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
        videosContainer.className = "py-6 text-center text-sm text-red-500";
        videosContainer.textContent = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    // ====== ã‚¿ãƒ–æ“ä½œ ======
    function setActiveTab(tab) {
      if (tab === "photos") {
        photosSection.classList.remove("hidden");
        videosSection.classList.add("hidden");
      } else {
        videosSection.classList.remove("hidden");
        photosSection.classList.add("hidden");
      }

      tabButtons.forEach((btn) => {
        const isActive = btn.dataset.tab === tab;
        if (isActive) {
          btn.classList.add("bg-white", "shadow-sm", "text-emerald-700");
          btn.classList.remove("text-emerald-600");
        } else {
          btn.classList.remove("bg-white", "shadow-sm", "text-emerald-700");
          btn.classList.add("text-emerald-600");
        }
      });
    }

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;
        setActiveTab(tab);
      });
    });

    // åˆæœŸè¡¨ç¤ºã¯å†™çœŸã‚¿ãƒ–
    setActiveTab("photos");
    loadAssetsOnce();
  </script>
</body>
</html>
