<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --green-main: #22c55e;
      --green-soft: #ecfdf3;
      --green-deep: #15803d;
    }
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top, #ecfdf5 0, #ffffff 55%, #eef2ff 100%);
      min-height: 100vh;
    }
    .title-font {
      font-family: 'Inter', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.12em;
    }
    .glass-card {
      border-radius: 1.75rem;
      background: rgba(255, 255, 255, 0.96);
      box-shadow:
        0 18px 40px rgba(15, 23, 42, 0.12),
        0 0 0 1px rgba(22, 163, 74, 0.05);
      backdrop-filter: blur(14px);
    }
    .badge-soft {
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.12);
      color: var(--green-deep);
    }
  </style>
</head>

<body class="px-4 py-8 md:px-6 md:py-10">
  <main class="max-w-5xl mx-auto">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-7 md:mb-8">
      <div>
        <p class="badge-soft inline-flex items-center gap-2 px-4 py-1 text-xs font-semibold mb-2">
          <span>ğŸŒï¸â€â™‚ï¸</span> å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš
        </p>
        <h1 class="title-font text-2xl md:text-3xl font-bold text-slate-900">
          ã‚®ãƒ£ãƒ©ãƒªãƒ¼
        </h1>
        <p class="text-xs md:text-sm text-slate-500 mt-1">
          ã¿ãªã•ã‚“ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚ŒãŸå†™çœŸãƒ»å‹•ç”»ãŒã“ã“ã«ä¸¦ã³ã¾ã™ã€‚
        </p>
      </div>

      <a
        href="https://tawaracup-2025-photo.netlify.app/"
        class="inline-flex items-center justify-center px-4 py-2 text-xs md:text-sm 
               rounded-full border border-emerald-300 text-emerald-700 bg-white/70
               hover:bg-emerald-50 font-medium transition"
      >
        â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚‹
      </a>
    </header>

    <!-- ã‚«ãƒ¼ãƒ‰æœ¬ä½“ -->
    <section class="glass-card p-5 md:p-7">
      <!-- ã‚¿ãƒ– -->
      <div class="flex items-center gap-2 mb-5 border-b border-slate-100 pb-3">
        <button
          id="photoTabBtn"
          class="flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full
                 bg-emerald-600 text-white shadow-sm shadow-emerald-300/60
                 transition"
          type="button"
        >
          å†™çœŸ
        </button>
        <button
          id="videoTabBtn"
          class="flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full
                 bg-white text-emerald-700 border border-emerald-100
                 hover:bg-emerald-50 transition"
          type="button"
        >
          å‹•ç”»
        </button>
      </div>

      <!-- å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
      <section id="photoSection">
        <div class="flex items-baseline justify-between mb-3">
          <h2 class="text-sm md:text-base font-semibold text-slate-800 flex items-center gap-2">
            <span class="w-1.5 h-6 rounded-full bg-emerald-500"></span>
            å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼
          </h2>
          <p class="text-[11px] text-slate-400">
            â€» ç”»åƒã‚’ã‚¿ãƒƒãƒ—ã€ã¾ãŸã¯ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰é•·æŠ¼ã—ã§ä¿å­˜ã§ãã¾ã™
          </p>
        </div>

        <p id="photoEmpty" class="text-xs md:text-sm text-slate-500 mt-2 hidden">
          ã¾ã å†™çœŸãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
        </p>

        <div
          id="photoGrid"
          class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"
        >
          <!-- JS ã§å†™çœŸã‚«ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ -->
        </div>
      </section>

      <!-- å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼ -->
      <section id="videoSection" class="hidden">
        <div class="flex items-baseline justify-between mb-3">
          <h2 class="text-sm md:text-base font-semibold text-slate-800 flex items-center gap-2">
            <span class="w-1.5 h-6 rounded-full bg-emerald-500"></span>
            å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
          </h2>
          <p class="text-[11px] text-slate-400">
            â€» å‹•ç”»ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å†ç”Ÿã•ã‚Œã¾ã™
          </p>
        </div>

        <p id="videoLoading" class="text-xs md:text-sm text-slate-400 mt-2 hidden">
          å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦
        </p>

        <p id="videoEmpty" class="text-xs md:text-sm text-slate-500 mt-2 hidden">
          ã¾ã å‹•ç”»ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
        </p>

        <div
          id="videoGrid"
          class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2"
        >
          <!-- JS ã§å‹•ç”»ã‚«ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ -->
        </div>
      </section>
    </section>

    <p class="mt-6 text-center text-[11px] text-slate-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </p>
  </main>

  <script>
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    const photoGrid = document.getElementById("photoGrid");
    const videoGrid = document.getElementById("videoGrid");
    const photoEmpty = document.getElementById("photoEmpty");
    const videoEmpty = document.getElementById("videoEmpty");
    const videoLoading = document.getElementById("videoLoading");

    const photoSection = document.getElementById("photoSection");
    const videoSection = document.getElementById("videoSection");
    const photoTabBtn = document.getElementById("photoTabBtn");
    const videoTabBtn = document.getElementById("videoTabBtn");

    let videosLoaded = false;
    let videosLoadingNow = false;

    // â–¼ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function activatePhotoTab() {
      photoSection.classList.remove("hidden");
      videoSection.classList.add("hidden");

      photoTabBtn.className =
        "flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full " +
        "bg-emerald-600 text-white shadow-sm shadow-emerald-300/60 transition";
      videoTabBtn.className =
        "flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full " +
        "bg-white text-emerald-700 border border-emerald-100 hover:bg-emerald-50 transition";
    }

    async function activateVideoTab() {
      videoSection.classList.remove("hidden");
      photoSection.classList.add("hidden");

      videoTabBtn.className =
        "flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full " +
        "bg-emerald-600 text-white shadow-sm shadow-emerald-300/60 transition";
      photoTabBtn.className =
        "flex-1 text-xs md:text-sm font-semibold px-3 py-2 rounded-full " +
        "bg-white text-emerald-700 border border-emerald-100 hover:bg-emerald-50 transition";

      // åˆå›ã ã‘å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ï¼ˆé‡ã„å‡¦ç†ã¯1å›ã ã‘ï¼‰
      if (!videosLoaded && !videosLoadingNow) {
        await loadVideos();
      }
    }

    photoTabBtn.addEventListener("click", activatePhotoTab);
    videoTabBtn.addEventListener("click", activateVideoTab);

    // â–¼ Cloudinary ã® list API ã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹å–å¾—
    async function fetchResources(resourceType) {
      const url = `https://res.cloudinary.com/${CLOUD_NAME}/${resourceType}/list/${TAG}.json`;
      try {
        const res = await fetch(url);
        if (!res.ok) {
          console.warn(resourceType, "list fetch failed:", res.status);
          return [];
        }
        const data = await res.json();
        return data.resources || [];
      } catch (err) {
        console.error("Error fetching", resourceType, "list:", err);
        return [];
      }
    }

    // â–¼ context ã‹ã‚‰ caption / alt ã‚’å®‰å…¨ã«å–å¾—ï¼ˆcustomã«ã‚‚å¯¾å¿œï¼‰
    function getContextValue(item, key) {
      if (!item.context) return "";
      if (item.context[key]) return item.context[key];
      if (item.context.custom && item.context.custom[key]) {
        return item.context.custom[key];
      }
      return "";
    }

    function safeDecode(value) {
      if (!value) return "";
      try {
        return decodeURIComponent(value);
      } catch (e) {
        return value;
      }
    }

    function openInNewTab(url) {
      window.open(url, "_blank", "noopener");
    }

    // â–¼ ç”»åƒã‚«ãƒ¼ãƒ‰
    function buildImageCard(item) {
      const url =
        item.secure_url ||
        `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/${item.public_id}.${item.format}`;

      const rawCaption = getContextValue(item, "caption");
      const rawAlt = getContextValue(item, "alt");

      const name = safeDecode(rawCaption);
      const comment = safeDecode(rawAlt);

      const wrapper = document.createElement("article");
      wrapper.className =
        "bg-white/90 rounded-2xl border border-slate-100 overflow-hidden shadow-sm flex flex-col";

      const imgWrapper = document.createElement("div");
      imgWrapper.className =
        "relative aspect-[4/3] overflow-hidden cursor-pointer bg-slate-100";

      const img = document.createElement("img");
      img.src = url;
      img.alt = comment || name || "photo";
      img.loading = "lazy";
      img.className =
        "w-full h-full object-cover transition-transform duration-200 hover:scale-[1.03]";

      imgWrapper.addEventListener("click", () => openInNewTab(url));

      imgWrapper.appendChild(img);
      wrapper.appendChild(imgWrapper);

      const info = document.createElement("div");
      info.className = "px-3 py-2.5 flex flex-col gap-1";

      if (name) {
        const nameEl = document.createElement("p");
        nameEl.className = "text-xs font-semibold text-slate-800 truncate";
        nameEl.textContent = name;
        info.appendChild(nameEl);
      }

      if (comment) {
        const commentEl = document.createElement("p");
        commentEl.className = "text-[11px] text-slate-500";
        commentEl.textContent = comment;
        info.appendChild(commentEl);
      }

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className =
        "mt-1.5 inline-flex items-center justify-center w-full text-[11px] font-medium " +
        "text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-full " +
        "py-1.5 hover:bg-emerald-100 transition";
      btn.innerHTML = "â†“ é–‹ã„ã¦ä¿å­˜";

      btn.addEventListener("click", () => openInNewTab(url));

      const hint = document.createElement("p");
      hint.className = "mt-0.5 text-[10px] text-slate-400 text-center";
      hint.textContent = "â€»é–‹ã„ãŸç”»é¢ã‚’é•·æŠ¼ã— â†’ã€å†™çœŸã«ä¿å­˜ã€ã‚’é¸ã‚“ã§ãã ã•ã„";

      info.appendChild(btn);
      info.appendChild(hint);

      wrapper.appendChild(info);

      return wrapper;
    }

    // â–¼ å‹•ç”»ã‚«ãƒ¼ãƒ‰
    function buildVideoCard(item) {
      const url =
        item.secure_url ||
        `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/${item.public_id}.${item.format}`;

      const rawCaption = getContextValue(item, "caption");
      const rawAlt = getContextValue(item, "alt");

      const name = safeDecode(rawCaption);
      const comment = safeDecode(rawAlt);

      const wrapper = document.createElement("article");
      wrapper.className =
        "bg-white/90 rounded-2xl border border-slate-100 overflow-hidden shadow-sm flex flex-col";

      const videoWrapper = document.createElement("div");
      videoWrapper.className =
        "relative aspect-video overflow-hidden bg-black/80";

      const video = document.createElement("video");
      video.src = url;
      video.controls = true;
      video.className = "w-full h-full object-contain bg-black";
      videoWrapper.appendChild(video);
      wrapper.appendChild(videoWrapper);

      const info = document.createElement("div");
      info.className = "px-3 py-2.5 flex flex-col gap-1";

      if (name) {
        const nameEl = document.createElement("p");
        nameEl.className = "text-xs font-semibold text-slate-800 truncate";
        nameEl.textContent = name;
        info.appendChild(nameEl);
      }

      if (comment) {
        const commentEl = document.createElement("p");
        commentEl.className = "text-[11px] text-slate-500";
        commentEl.textContent = comment;
        info.appendChild(commentEl);
      }

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className =
        "mt-1.5 inline-flex items-center justify-center w-full text-[11px] font-medium " +
        "text-emerald-700 bg-emerald-50 border border-emerald-100 rounded-full " +
        "py-1.5 hover:bg-emerald-100 transition";
      btn.innerHTML = "â†“ é–‹ã„ã¦ä¿å­˜";

      btn.addEventListener("click", () => openInNewTab(url));

      const hint = document.createElement("p");
      hint.className = "mt-0.5 text-[10px] text-slate-400 text-center";
      hint.textContent = "â€»é–‹ã„ãŸç”»é¢ã‚’é•·æŠ¼ã— â†’ã€ãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€ã‚’é¸ã‚“ã§ãã ã•ã„";

      info.appendChild(btn);
      info.appendChild(hint);

      wrapper.appendChild(info);

      return wrapper;
    }

    // â–¼ ç”»åƒèª­ã¿è¾¼ã¿ï¼ˆåˆå›ï¼‰
    async function loadImages() {
      const images = await fetchResources("image");
      if (!images || images.length === 0) {
        photoEmpty.classList.remove("hidden");
      } else {
        images.forEach((item) => {
          const card = buildImageCard(item);
          photoGrid.appendChild(card);
        });
      }
    }

    // â–¼ å‹•ç”»èª­ã¿è¾¼ã¿ï¼ˆå‹•ç”»ã‚¿ãƒ–ã‚’åˆã‚ã¦é–‹ã„ãŸã¨ãã ã‘ï¼‰
    async function loadVideos() {
      videosLoadingNow = true;
      videoLoading.classList.remove("hidden");
      videoEmpty.classList.add("hidden");

      const videos = await fetchResources("video");

      videoLoading.classList.add("hidden");
      videosLoadingNow = false;

      if (!videos || videos.length === 0) {
        videoEmpty.classList.remove("hidden");
        videosLoaded = true;
        return;
      }

      videos.forEach((item) => {
        const card = buildVideoCard(item);
        videoGrid.appendChild(card);
      });

      videosLoaded = true;
    }

    // â–¼ åˆæœŸåŒ–
    async function initGallery() {
      await loadImages();
      activatePhotoTab(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å†™çœŸã‚¿ãƒ–
    }

    initGallery();
  </script>
</body>
</html>
