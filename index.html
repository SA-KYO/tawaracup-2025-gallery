<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwindï¼ˆCDNç‰ˆï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  >

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.06em;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-emerald-50 via-white to-emerald-50 min-h-screen">

  <!-- ãƒ©ãƒƒãƒ‘ãƒ¼ -->
  <div class="max-w-5xl mx-auto px-4 py-6 md:py-10">

    <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="flex justify-between items-center mb-4 md:mb-6">
      <button
        onclick="window.location.href='https://tawaracup-2025-photo.netlify.app/'"
        class="inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-emerald-200 bg-white text-emerald-700 text-xs md:text-sm hover:bg-emerald-50 transition shadow-sm"
      >
        â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã‚‹
      </button>
    </div>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="text-center mb-6 md:mb-8">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-emerald-600 text-white text-xs md:text-sm shadow-md animate-pulse">
        <span class="text-lg">ğŸŒï¸â€â™‚ï¸</span>
        <span class="font-semibold">å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš</span>
        <span class="text-yellow-200 text-base">âœ¨</span>
      </div>
      <h1 class="title-font text-2xl md:text-3xl font-bold text-slate-900 mt-4">
        å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
      </h1>
      <p class="text-xs md:text-sm text-slate-500 mt-2">
        ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆãŒä¸¦ã³ã¾ã™ã€‚
      </p>
    </header>

    <!-- ã‚¿ãƒ–ï¼‹èª¬æ˜ã‚«ãƒ¼ãƒ‰ -->
    <section class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg border border-emerald-100 p-4 md:p-6 mb-6 md:mb-8">
      <!-- ã‚¿ãƒ– -->
      <div class="flex justify-center mb-4">
        <div class="inline-flex bg-emerald-50 rounded-full p-1 border border-emerald-100 shadow-inner">
          <button
            id="tabPhotos"
            class="tab-btn inline-flex items-center gap-1 px-4 md:px-6 py-2 rounded-full text-xs md:text-sm font-semibold text-white bg-emerald-500 shadow-md"
            data-target="photosPanel"
          >
            <span class="text-base">ğŸ“·</span> å†™çœŸ
          </button>
          <button
            id="tabVideos"
            class="tab-btn inline-flex items-center gap-1 px-4 md:px-6 py-2 rounded-full text-xs md:text-sm font-semibold text-emerald-600"
            data-target="videosPanel"
          >
            <span class="text-base">ğŸ¥</span> å‹•ç”»
          </button>
        </div>
      </div>

      <!-- èª¬æ˜ -->
      <div class="text-xs md:text-sm text-slate-600 leading-relaxed">
        <p class="mb-1">
          ã‚¹ãƒãƒ›ï¼š<span class="font-semibold">ã‚µãƒ ãƒã‚¤ãƒ« ã¾ãŸã¯ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€</span> ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ç”»åƒï¼å‹•ç”»ãŒåˆ¥ã‚¿ãƒ–ã§é–‹ãã¾ã™ã€‚
          ãã“ã§ <span class="font-semibold">é•·æŠ¼ã— â†’ã€Œå†™çœŸã«ä¿å­˜ã€ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€</span> ãªã©ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
        </p>
        <p>
          PCï¼šã‚µãƒ ãƒã‚¤ãƒ« orã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€â†’ é–‹ã„ãŸç”»é¢ã§å³ã‚¯ãƒªãƒƒã‚¯ â†’ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
        </p>
      </div>
    </section>

    <!-- å†™çœŸãƒ‘ãƒãƒ« -->
    <section id="photosPanel">
      <h2 class="flex items-center gap-2 text-lg md:text-xl font-bold text-slate-800 mb-3">
        <span class="text-xl">ğŸ“¸</span> å†™çœŸä¸€è¦§
      </h2>
      <p class="text-xs md:text-sm text-slate-500 mb-3">
        æ°—ã«å…¥ã£ãŸå†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å¤§ããè¡¨ç¤ºã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰ã‚‚åŒã˜ç”»é¢ã‚’é–‹ã‘ã¾ã™ã€‚
      </p>

      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ã‚¨ãƒ©ãƒ¼ -->
      <p id="photosStatus" class="text-xs md:text-sm text-slate-500 mb-3"></p>

      <!-- ã‚°ãƒªãƒƒãƒ‰ -->
      <div id="photosGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-5"></div>
    </section>

    <!-- å‹•ç”»ãƒ‘ãƒãƒ« -->
    <section id="videosPanel" class="hidden">
      <h2 class="flex items-center gap-2 text-lg md:text-xl font-bold text-slate-800 mb-3">
        <span class="text-xl">ğŸ¬</span> å‹•ç”»ä¸€è¦§
      </h2>
      <p class="text-xs md:text-sm text-slate-500 mb-3">
        è¦‹ãŸã„å‹•ç”»ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å†ç”Ÿã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰ã‚‚åŒã˜ç”»é¢ã‚’é–‹ã‘ã¾ã™ã€‚
      </p>

      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ã‚¨ãƒ©ãƒ¼ -->
      <p id="videosStatus" class="text-xs md:text-sm text-slate-500 mb-3"></p>

      <!-- ã‚°ãƒªãƒƒãƒ‰ -->
      <div id="videosGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-5"></div>
    </section>

    <!-- ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ -->
    <footer class="mt-10 text-center text-[11px] text-slate-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </div>

  <script>
    // ===== Cloudinary è¨­å®š =====
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    const photosGrid = document.getElementById("photosGrid");
    const videosGrid = document.getElementById("videosGrid");
    const photosStatus = document.getElementById("photosStatus");
    const videosStatus = document.getElementById("videosStatus");

    // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
    function escapeHtml(str) {
      if (!str) return "";
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function decodeContext(value) {
      if (!value) return "";
      try {
        return decodeURIComponent(value);
      } catch (e) {
        return value;
      }
    }

    function openInNewTab(url) {
      if (!url) return;
      window.open(url, "_blank");
    }

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    const tabButtons = document.querySelectorAll(".tab-btn");
    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const targetId = btn.dataset.target;

        // active åˆ‡ã‚Šæ›¿ãˆ
        tabButtons.forEach((b) => {
          if (b === btn) {
            b.classList.add("bg-emerald-500", "text-white", "shadow-md");
            b.classList.remove("text-emerald-600");
          } else {
            b.classList.remove("bg-emerald-500", "text-white", "shadow-md");
            b.classList.add("text-emerald-600");
          }
        });

        // ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById("photosPanel").classList.toggle(
          "hidden",
          targetId !== "photosPanel"
        );
        document.getElementById("videosPanel").classList.toggle(
          "hidden",
          targetId !== "videosPanel"
        );
      });
    });

    // ===== å†™çœŸã‚’èª­ã¿è¾¼ã¿ =====
    async function loadPhotos() {
      photosStatus.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
      photosGrid.innerHTML = "";

      try {
        const url = `https://res.cloudinary.com/${CLOUD_NAME}/image/list/${TAG}.json`;
        const res = await fetch(url, { cache: "no-store" });

        if (!res.ok) {
          // 404 â†’ ã¾ã å†™çœŸãŒãªã„ã¨ã¿ãªã™
          if (res.status === 404) {
            photosStatus.textContent = "ã¾ã å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
            return;
          }
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const resources = data.resources || [];

        if (!resources.length) {
          photosStatus.textContent = "ã¾ã å†™çœŸãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
          return;
        }

        photosStatus.textContent = "";

        const fragments = document.createDocumentFragment();

        resources.forEach((item) => {
          const publicId = item.public_id;
          const format = item.format;

          const ctx = (item.context && item.context.custom) || {};
          const name = decodeContext(ctx.caption || "");
          const comment = decodeContext(ctx.alt || "");

          const thumbUrl = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/c_fill,w_600,h_600,q_auto,f_auto/${publicId}.${format}`;
          const fullUrl = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/f_auto,q_auto/${publicId}.${format}`;

          const card = document.createElement("article");
          card.className =
            "bg-white rounded-2xl border border-emerald-100 shadow-sm overflow-hidden flex flex-col hover:shadow-md transition";

          card.innerHTML = `
            <button type="button" class="block relative group">
              <img
                src="${thumbUrl}"
                alt="${escapeHtml(comment || name || "ã‚³ãƒ³ãƒšå†™çœŸ")}"
                class="w-full aspect-[4/3] object-cover"
              >
              <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition"></div>
            </button>
            <div class="px-3 pt-2 pb-3 flex flex-col gap-1 text-[11px] md:text-xs text-slate-600">
              <p class="font-semibold text-slate-800 truncate">${escapeHtml(name || "ãŠåå‰ãªã—")}</p>
              <p class="line-clamp-2 min-h-[2.4em]">${escapeHtml(comment || "ã‚³ãƒ¡ãƒ³ãƒˆãªã—")}</p>
              <button
                type="button"
                class="mt-1 w-full inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 font-semibold text-[11px] md:text-xs hover:bg-emerald-100 border border-emerald-100"
              >
                <span class="text-base">â¬‡</span> é–‹ã„ã¦ä¿å­˜
              </button>
            </div>
          `;

          // ã‚µãƒ ãƒã‚¤ãƒ«ã‚¯ãƒªãƒƒã‚¯ â†’ æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
          const thumbBtn = card.querySelector("button");
          thumbBtn.addEventListener("click", () => openInNewTab(fullUrl));

          // é–‹ã„ã¦ä¿å­˜ãƒœã‚¿ãƒ³
          const saveBtn = card.querySelectorAll("button")[1];
          saveBtn.addEventListener("click", () => openInNewTab(fullUrl));

          fragments.appendChild(card);
        });

        photosGrid.appendChild(fragments);
      } catch (err) {
        console.error("photos load error:", err);
        photosStatus.textContent =
          "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    // ===== å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ =====
    async function loadVideos() {
      videosStatus.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
      videosGrid.innerHTML = "";

      try {
        const url = `https://res.cloudinary.com/${CLOUD_NAME}/video/list/${TAG}.json`;
        const res = await fetch(url, { cache: "no-store" });

        if (!res.ok) {
          if (res.status === 404) {
            videosStatus.textContent = "ã¾ã å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
            return;
          }
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const resources = data.resources || [];

        if (!resources.length) {
          videosStatus.textContent = "ã¾ã å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
          return;
        }

        videosStatus.textContent = "";

        const fragments = document.createDocumentFragment();

        resources.forEach((item) => {
          const publicId = item.public_id;
          const format = item.format;

          const ctx = (item.context && item.context.custom) || {};
          const name = decodeContext(ctx.caption || "");
          const comment = decodeContext(ctx.alt || "");

          // å‹•ç”»ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆ0ç§’ã‚ãŸã‚Šã‚’é™æ­¢ç”»ã«ï¼‰
          const thumbUrl = `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/so_1/c_fill,w_600,h_600,q_auto,f_auto/${publicId}.jpg`;
          const fullUrl = `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/${publicId}.${format}`;

          const card = document.createElement("article");
          card.className =
            "bg-white rounded-2xl border border-emerald-100 shadow-sm overflow-hidden flex flex-col hover:shadow-md transition";

          card.innerHTML = `
            <button type="button" class="block relative group">
              <img
                src="${thumbUrl}"
                alt="${escapeHtml(comment || name || "ã‚³ãƒ³ãƒšå‹•ç”»")}"
                class="w-full aspect-[4/3] object-cover"
              >
              <div class="absolute inset-0 bg-black/25 flex items-center justify-center text-white text-3xl">
                â–¶
              </div>
            </button>
            <div class="px-3 pt-2 pb-3 flex flex-col gap-1 text-[11px] md:text-xs text-slate-600">
              <p class="font-semibold text-slate-800 truncate">${escapeHtml(name || "ãŠåå‰ãªã—")}</p>
              <p class="line-clamp-2 min-h-[2.4em]">${escapeHtml(comment || "ã‚³ãƒ¡ãƒ³ãƒˆãªã—")}</p>
              <button
                type="button"
                class="mt-1 w-full inline-flex items-center justify-center gap-1 px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 font-semibold text-[11px] md:text-xs hover:bg-emerald-100 border border-emerald-100"
              >
                <span class="text-base">â¬‡</span> é–‹ã„ã¦ä¿å­˜
              </button>
            </div>
          `;

          const thumbBtn = card.querySelector("button");
          thumbBtn.addEventListener("click", () => openInNewTab(fullUrl));

          const saveBtn = card.querySelectorAll("button")[1];
          saveBtn.addEventListener("click", () => openInNewTab(fullUrl));

          fragments.appendChild(card);
        });

        videosGrid.appendChild(fragments);
      } catch (err) {
        console.error("videos load error:", err);
        videosStatus.textContent =
          "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚";
      }
    }

    // ===== åˆæœŸãƒ­ãƒ¼ãƒ‰ =====
    document.addEventListener("DOMContentLoaded", () => {
      loadPhotos();
      loadVideos(); // å…ˆã«ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã®ã§ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãŒã‚µã‚¯ã‚µã‚¯
    });
  </script>
</body>
</html>
