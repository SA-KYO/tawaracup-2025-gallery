<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind CSSï¼ˆCDNç‰ˆï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  >

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont,
        'Segoe UI', sans-serif;
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.08em;
    }
    /* ã‚³ãƒ³ãƒšãƒãƒƒã‚¸ã®ã‚­ãƒ©ãƒƒâœ¨ç”¨ */
    .sparkle {
      position: relative;
      overflow: hidden;
    }
    .sparkle::after {
      content: "";
      position: absolute;
      top: -120%;
      left: -120%;
      width: 80%;
      height: 300%;
      background: linear-gradient(
        120deg,
        transparent 0%,
        rgba(255, 255, 255, 0.9) 50%,
        transparent 100%
      );
      transform: translateX(-100%) rotate(20deg);
      opacity: 0;
      pointer-events: none;
    }
    .sparkle-animate::after {
      animation: sparkleSweep 1s ease-out forwards;
    }
    @keyframes sparkleSweep {
      0% {
        transform: translateX(-120%) rotate(20deg);
        opacity: 0;
      }
      20% {
        opacity: 1;
      }
      100% {
        transform: translateX(160%) rotate(20deg);
        opacity: 0;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-b from-emerald-50 via-white to-emerald-100 min-h-screen">

  <main class="max-w-5xl mx-auto px-4 py-10 md:py-14">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="mb-8 md:mb-10 text-center">
      <div
        id="badge"
        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-100 text-emerald-800 text-xs md:text-sm font-semibold sparkle shadow-sm"
      >
        <span>ğŸŒï¸â€â™‚ï¸</span>
        <span>å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš</span>
        <span class="text-amber-400 text-base">âœ¨</span>
      </div>

      <h1 class="title-font text-2xl md:text-3xl font-bold text-slate-900 mt-4">
        å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
      </h1>
      <p class="mt-2 text-sm md:text-base text-slate-600">
        ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆãŒä¸¦ã³ã¾ã™ã€‚
      </p>
    </header>

    <!-- ä¸Šéƒ¨ãƒŠãƒ“ & èª¬æ˜ -->
    <section
      class="bg-white/90 backdrop-blur rounded-3xl shadow-lg border border-emerald-100 p-4 md:p-6 mb-8"
    >
      <!-- ã‚¿ãƒ– -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex justify-center md:justify-start">
          <div
            class="inline-flex items-center rounded-full bg-emerald-50 border border-emerald-100 p-1"
          >
            <button
              id="tabPhotos"
              class="px-5 py-1.5 text-sm font-semibold rounded-full bg-emerald-600 text-white shadow-sm flex items-center gap-1 transition"
            >
              <span>ğŸ“·</span><span>å†™çœŸ</span>
            </button>
            <button
              id="tabVideos"
              class="px-5 py-1.5 text-sm font-semibold rounded-full text-emerald-700 flex items-center gap-1 transition"
            >
              <span>ğŸ¥</span><span>å‹•ç”»</span>
            </button>
          </div>
        </div>

        <div class="text-xs md:text-[13px] text-slate-500 space-y-1">
          <p>
            ã‚¹ãƒãƒ›ï¼š<span class="font-semibold">ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€</span>ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ— â†’
            é–‹ã„ãŸç”»é¢ã§å…±æœ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰<strong>ã€Œå†™çœŸã«ä¿å­˜ã€ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€</strong>ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
          </p>
          <p>
            PCï¼šã‚µãƒ ãƒã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ é–‹ã„ãŸç”»é¢ã§å³ã‚¯ãƒªãƒƒã‚¯ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
          </p>
        </div>
      </div>
    </section>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° / ã‚¨ãƒ©ãƒ¼ -->
    <p id="loading" class="text-center text-sm text-slate-500 mt-4">
      èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦
    </p>
    <p
      id="globalError"
      class="hidden text-center text-sm text-red-500 mt-4"
    >
      èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚
    </p>

    <!-- å†™çœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="photosSection" class="mt-4">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-lg">ğŸ“¸</span>
        <h2 class="text-base md:text-lg font-semibold text-slate-800">
          å†™çœŸä¸€è¦§
        </h2>
      </div>
      <p class="text-xs text-slate-500 mb-3">
        æ°—ã«å…¥ã£ãŸå†™çœŸã‚’ã‚¿ãƒƒãƒ— â†’ å…¨ç”»é¢è¡¨ç¤ºã§ç¢ºèªã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã§å…±æœ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ä¿å­˜ã‚‚ã§ãã¾ã™ã€‚
      </p>

      <div
        id="photosGrid"
        class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-5"
      ></div>

      <p
        id="photosEmpty"
        class="hidden text-sm text-slate-400 mt-6 text-center"
      >
        ã¾ã å†™çœŸã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
      </p>
    </section>

    <!-- å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="videosSection" class="mt-8 hidden">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-lg">ğŸ¬</span>
        <h2 class="text-base md:text-lg font-semibold text-slate-800">
          å‹•ç”»ä¸€è¦§
        </h2>
      </div>
      <p class="text-xs text-slate-500 mb-3">
        å‹•ç”»ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åˆ¥ã‚¿ãƒ–ã§å†ç”Ÿã§ãã¾ã™ã€‚ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã§å…±æœ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ç«¯æœ«ã«ä¿å­˜ã§ãã¾ã™ã€‚
      </p>

      <div
        id="videosGrid"
        class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-5"
      ></div>

      <p
        id="videosEmpty"
        class="hidden text-sm text-slate-400 mt-6 text-center"
      >
        ã¾ã å‹•ç”»ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
      </p>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="mt-10 text-center text-[11px] md:text-xs text-slate-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </main>

  <script>
    // ====== Cloudinary è¨­å®š ======
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    const imageListUrl =
      "https://res.cloudinary.com/" +
      CLOUD_NAME +
      "/image/list/" +
      TAG +
      ".json";
    const videoListUrl =
      "https://res.cloudinary.com/" +
      CLOUD_NAME +
      "/video/list/" +
      TAG +
      ".json";

    const loadingEl = document.getElementById("loading");
    const globalErrorEl = document.getElementById("globalError");

    const photosGrid = document.getElementById("photosGrid");
    const videosGrid = document.getElementById("videosGrid");
    const photosEmptyEl = document.getElementById("photosEmpty");
    const videosEmptyEl = document.getElementById("videosEmpty");

    const photosSection = document.getElementById("photosSection");
    const videosSection = document.getElementById("videosSection");
    const tabPhotosBtn = document.getElementById("tabPhotos");
    const tabVideosBtn = document.getElementById("tabVideos");

    // ====== ã‚­ãƒ©ãƒƒâœ¨ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ======
    const badge = document.getElementById("badge");
    setInterval(() => {
      badge.classList.remove("sparkle-animate");
      // å°‘ã—é…ã‚‰ã›ã¦å†ä»˜ä¸
      setTimeout(() => {
        badge.classList.add("sparkle-animate");
      }, 50);
    }, 1200);

    // ====== å®‰å…¨ãª decodeURIComponent ======
    function safeDecode(value) {
      if (!value) return "";
      try {
        return decodeURIComponent(value);
      } catch {
        return value;
      }
    }

    // ====== Web Share API + ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ ======
    async function handleSaveMedia(url, filenameFallback) {
      try {
        const hasShare = !!navigator.share && !!navigator.canShare;
        if (hasShare) {
          const res = await fetch(url);
          if (!res.ok) throw new Error("fetch failed: " + res.status);
          const blob = await res.blob();

          const mime = blob.type || "application/octet-stream";
          let filename = filenameFallback || "media";
          if (!/\./.test(filename)) {
            if (mime.startsWith("image/")) filename += ".jpg";
            else if (mime.startsWith("video/")) filename += ".mp4";
          }

          const file = new File([blob], filename, { type: mime });

          if (navigator.canShare({ files: [file] })) {
            await navigator.share({
              files: [file],
              title: "å¤šå’Œæ¥½æ¯2025",
              text: "å†™çœŸãƒ»å‹•ç”»ã‚’ä¿å­˜ã™ã‚‹ã‹ã€ä»–ã®ã‚¢ãƒ—ãƒªã¸å…±æœ‰ã§ãã¾ã™ã€‚",
            });
            return;
          }
        }

        // Web Share ã‚’ä½¿ãˆãªã„å ´åˆã¯æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
        window.open(url, "_blank");
      } catch (err) {
        console.error("handleSaveMedia error:", err);
        window.open(url, "_blank");
      }
    }

    // ====== ãƒªã‚½ãƒ¼ã‚¹å–å¾—ï¼ˆ404 ã¯ã€Œç„¡ã„ã‚‚ã®ã€ã¨ã—ã¦æ‰±ã†ï¼‰ ======
    async function fetchResources(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) {
          if (res.status === 404) {
            // ã‚¿ã‚°ä»˜ãã®ãƒªã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒã¾ã ç„¡ã„ã¨ã
            return [];
          }
          throw new Error("status " + res.status);
        }
        const data = await res.json();
        return Array.isArray(data.resources) ? data.resources : [];
      } catch (err) {
        console.error("fetchResources error:", err, "url:", url);
        return [];
      }
    }

    // ====== ã‚«ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆå…±é€šï¼‰ ======
    function createMediaCard(resource, options) {
      const { isVideo } = options;

      const publicId = resource.public_id || "";
      const format = resource.format || "";
      const originalUrl = resource.secure_url;

      const customCtx = resource.context && resource.context.custom;
      const rawName = customCtx && customCtx.caption;
      const rawComment = customCtx && customCtx.alt;

      const name = safeDecode(rawName) || "";
      const comment = safeDecode(rawComment) || "";

      // ã‚µãƒ ãƒã‚¤ãƒ«URL
      let thumbUrl;
      if (isVideo) {
        // å‹•ç”»ã®1ã‚³ãƒã‚’é™æ­¢ç”»ã‚µãƒ ãƒã‚¤ãƒ«ã«
        thumbUrl =
          "https://res.cloudinary.com/" +
          CLOUD_NAME +
          "/video/upload/so_1,c_fill,w_800,h_800,q_auto,f_jpg/" +
          publicId +
          ".jpg";
      } else {
        thumbUrl =
          "https://res.cloudinary.com/" +
          CLOUD_NAME +
          "/image/upload/c_fill,w_800,h_800,q_auto,f_auto/" +
          publicId +
          "." +
          format;
      }

      const card = document.createElement("article");
      card.className =
        "bg-white rounded-2xl shadow-sm border border-emerald-50 overflow-hidden flex flex-col";

      card.innerHTML = `
        <button type="button" class="thumb-btn relative group">
          <img
            src="${thumbUrl}"
            alt="${name ? name : "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ¡ãƒ‡ã‚£ã‚¢"}"
            loading="lazy"
            class="w-full aspect-[4/5] object-cover transition-transform duration-200 group-hover:scale-[1.02]"
          />
          ${
            isVideo
              ? `
          <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="bg-black/60 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z" />
              </svg>
            </div>
          </div>`
              : ""
          }
        </button>

        <div class="px-3 pt-2 pb-3 text-xs text-slate-600 flex flex-col gap-1">
          ${
            name || comment
              ? `<p class="font-semibold text-slate-800 truncate">${name || "ãŠåå‰ãªã—"}</p>`
              : `<p class="font-semibold text-slate-400">ãŠåå‰ãªã—</p>`
          }
          ${
            comment
              ? `<p class="text-[11px] leading-snug whitespace-pre-line">${comment}</p>`
              : `<p class="text-[11px] text-slate-400">ã‚³ãƒ¡ãƒ³ãƒˆãªã—</p>`
          }
          <button
            type="button"
            class="mt-2 inline-flex items-center justify-center rounded-full border border-emerald-300 bg-emerald-50 text-emerald-700 font-semibold text-[11px] py-1.5 px-3 hover:bg-emerald-100 transition"
          >
            <span class="mr-1">â†“</span><span>é–‹ã„ã¦ä¿å­˜</span>
          </button>
        </div>
      `;

      const thumbBtn = card.querySelector(".thumb-btn");
      const saveBtn = card.querySelector("button:last-child");

      // ã‚µãƒ ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒ— â†’ åˆ¥ã‚¿ãƒ–ã§é–‹ã
      if (thumbBtn) {
        thumbBtn.addEventListener("click", () => {
          if (originalUrl) {
            window.open(originalUrl, "_blank");
          }
        });
      }

      // ä¿å­˜ãƒœã‚¿ãƒ³ â†’ Web Share or æ–°ã‚¿ãƒ–
      if (saveBtn) {
        saveBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          if (originalUrl) {
            const simpleName = publicId.split("/").pop() || "media";
            handleSaveMedia(originalUrl, simpleName);
          }
        });
      }

      return card;
    }

    // ====== æç”» ======
    async function initGallery() {
      loadingEl.classList.remove("hidden");
      globalErrorEl.classList.add("hidden");
      photosGrid.innerHTML = "";
      videosGrid.innerHTML = "";

      const [photos, videos] = await Promise.all([
        fetchResources(imageListUrl),
        fetchResources(videoListUrl),
      ]);

      loadingEl.classList.add("hidden");

      // å†™çœŸ
      if (photos.length === 0) {
        photosEmptyEl.classList.remove("hidden");
      } else {
        photosEmptyEl.classList.add("hidden");
        const frag = document.createDocumentFragment();
        photos.forEach((res) => {
          const card = createMediaCard(res, { isVideo: false });
          frag.appendChild(card);
        });
        photosGrid.appendChild(frag);
      }

      // å‹•ç”»
      if (videos.length === 0) {
        videosEmptyEl.classList.remove("hidden");
      } else {
        videosEmptyEl.classList.add("hidden");
        const frag = document.createDocumentFragment();
        videos.forEach((res) => {
          const card = createMediaCard(res, { isVideo: true });
          frag.appendChild(card);
        });
        videosGrid.appendChild(frag);
      }

      // ã©ã¡ã‚‰ã‚‚ 0 ã§ã€ã‹ã¤ JSON å–å¾—ã‚‚å…¨ã¦ç©º â†’ å®Œå…¨ã«ä½•ã‚‚ãªã„ or ä½•ã‹ãŠã‹ã—ã„
      if (photos.length === 0 && videos.length === 0) {
        // ã“ã“ã§ã¯ã¨ã‚Šã‚ãˆãšã€Œã‚¨ãƒ©ãƒ¼ã€ã§ã¯ãªãã€Œã¾ã ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€æ‰±ã„ã«ã™ã‚‹
        // æœ¬å½“ã«ã‚¨ãƒ©ãƒ¼ã‹ã©ã†ã‹ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™
        console.log(
          "Cloudinary ã‹ã‚‰å†™çœŸãƒ»å‹•ç”»ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆã‚¿ã‚°:",
          TAG,
          "ï¼‰"
        );
      }
    }

    // ====== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ======
    function showTab(kind) {
      const isPhotos = kind === "photos";

      if (isPhotos) {
        photosSection.classList.remove("hidden");
        videosSection.classList.add("hidden");

        tabPhotosBtn.classList.add(
          "bg-emerald-600",
          "text-white",
          "shadow-sm"
        );
        tabPhotosBtn.classList.remove("text-emerald-700");

        tabVideosBtn.classList.remove(
          "bg-emerald-600",
          "text-white",
          "shadow-sm"
        );
        tabVideosBtn.classList.add("text-emerald-700");
      } else {
        photosSection.classList.add("hidden");
        videosSection.classList.remove("hidden");

        tabVideosBtn.classList.add(
          "bg-emerald-600",
          "text-white",
          "shadow-sm"
        );
        tabVideosBtn.classList.remove("text-emerald-700");

        tabPhotosBtn.classList.remove(
          "bg-emerald-600",
          "text-white",
          "shadow-sm"
        );
        tabPhotosBtn.classList.add("text-emerald-700");
      }
    }

    tabPhotosBtn.addEventListener("click", () => showTab("photos"));
    tabVideosBtn.addEventListener("click", () => showTab("videos"));

    // åˆæœŸã‚¿ãƒ–
    showTab("photos");

    // åˆæœŸãƒ­ãƒ¼ãƒ‰
    initGallery();
  </script>
</body>
</html>
