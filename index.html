<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šå’Œæ¥½æ¯2025 ã‚®ãƒ£ãƒ©ãƒªãƒ¼</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont,
        'Segoe UI', sans-serif;
    }
    .title-font {
      font-family: 'Poppins', 'Noto Sans JP', system-ui, sans-serif;
      letter-spacing: 0.06em;
    }

    /* ã‚³ãƒ³ãƒšãƒãƒƒã‚¸ã®ã‚­ãƒ©ãƒƒæ¼”å‡º */
    .badge-shine {
      position: relative;
      overflow: hidden;
    }
    .badge-shine::after {
      content: "";
      position: absolute;
      top: -150%;
      left: -50%;
      width: 40%;
      height: 300%;
      background: linear-gradient(
        120deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.85) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: translateX(-100%) rotate(20deg);
      animation: shine 2.5s linear infinite;
    }
    @keyframes shine {
      0% {
        transform: translateX(-120%) rotate(20deg);
      }
      40% {
        transform: translateX(220%) rotate(20deg);
      }
      100% {
        transform: translateX(220%) rotate(20deg);
      }
    }

    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .preview-hidden {
      display: none;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-emerald-50 via-emerald-50 to-white min-h-screen">

  <!-- å…¨ä½“ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div class="max-w-5xl mx-auto px-4 py-6 md:py-10">

    <!-- ä¸Šéƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="flex items-center justify-between mb-6 md:mb-8">
      <div>
        <div
          class="inline-flex items-center gap-2 badge-shine bg-emerald-100 text-emerald-800 px-4 py-1.5 rounded-full text-xs md:text-sm font-semibold shadow-sm"
        >
          <span class="text-lg">â›³</span>
          <span>å¤šå’Œæ¥½æ¯2025 ã‚³ãƒ³ãƒš</span>
        </div>
        <h1
          class="title-font text-2xl md:text-3xl font-bold text-slate-900 mt-3"
        >
          å†™çœŸãƒ»å‹•ç”»ã‚®ãƒ£ãƒ©ãƒªãƒ¼
        </h1>
        <p class="text-sm md:text-base text-slate-600 mt-1">
          ã‚³ãƒ³ãƒšå½“æ—¥ã«ã¿ã‚“ãªãŒã‚¢ãƒƒãƒ—ã—ã¦ãã‚ŒãŸãƒ™ã‚¹ãƒˆã‚·ãƒ§ãƒƒãƒˆãŒä¸¦ã³ã¾ã™ã€‚
        </p>
      </div>

      <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã¸æˆ»ã‚‹ -->
      <a
        href="https://tawaracup-2025-photo.netlify.app/"
        class="hidden sm:inline-flex items-center gap-1.5 px-3 py-2 rounded-full border border-emerald-300 text-emerald-700 text-xs md:text-sm font-semibold hover:bg-emerald-50 transition"
      >
        â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã¸æˆ»ã‚‹
      </a>
    </header>

    <!-- ã‚¹ãƒãƒ›ç”¨ æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <div class="sm:hidden mb-4">
      <a
        href="https://tawaracup-2025-photo.netlify.app/"
        class="inline-flex items-center gap-1.5 px-3 py-2 rounded-full border border-emerald-300 text-emerald-700 text-xs font-semibold hover:bg-emerald-50 transition"
      >
        â† ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»é¢ã¸æˆ»ã‚‹
      </a>
    </div>

    <!-- èª¬æ˜ï¼†ã‚¿ãƒ– -->
    <section
      class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-md border border-emerald-100 px-4 md:px-6 py-4 md:py-5 mb-6"
    >
      <!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
      <div
        class="inline-flex items-center bg-emerald-50 rounded-full p-1 mb-3 shadow-inner"
      >
        <button
          id="tab-photo"
          class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-1.5 md:px-6 md:py-2 rounded-full text-xs md:text-sm font-semibold transition
                 bg-emerald-500 text-white shadow"
          type="button"
        >
          <span>ğŸ“·</span>
          <span>å†™çœŸ</span>
        </button>
        <button
          id="tab-video"
          class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-1.5 md:px-6 md:py-2 rounded-full text-xs md:text-sm font-semibold transition
                 text-emerald-700"
          type="button"
        >
          <span>ğŸ¬</span>
          <span>å‹•ç”»</span>
        </button>
      </div>

      <!-- ä¿å­˜æ–¹æ³•ã®èª¬æ˜ -->
      <p class="text-xs md:text-sm text-slate-600 leading-relaxed">
        <span class="font-semibold">ã‚¹ãƒãƒ›ï¼š</span>
        ã‚µãƒ ãƒã‚¤ãƒ« ã¾ãŸã¯ã€Œ<span class="font-semibold">â†“ é–‹ã„ã¦ä¿å­˜</span>ã€ãƒœã‚¿ãƒ³ã‚’
        ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ç”»åƒãƒ»å‹•ç”»ãŒ<span class="font-semibold">åˆ¥ã‚¿ãƒ–</span>ã§é–‹ãã¾ã™ã€‚
        ãã“ã§é•·æŠ¼ã—ã—ã¦
        <span class="font-semibold">ã€Œå†™çœŸã«ä¿å­˜ã€</span> /
        <span class="font-semibold">ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€</span> ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚<br />
        <span class="font-semibold">PCï¼š</span>
        ã‚µãƒ ãƒã‚¤ãƒ« or ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ â†’ é–‹ã„ãŸç”»é¢ã§å³ã‚¯ãƒªãƒƒã‚¯ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
      </p>
    </section>

    <!-- å†™çœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="photo-section" class="mb-8">
      <h2 class="flex items-center gap-2 text-lg md:text-xl font-bold text-slate-900 mb-2">
        <span>ğŸ“¸</span>
        <span>å†™çœŸä¸€è¦§</span>
      </h2>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        æ°—ã«å…¥ã£ãŸå†™çœŸã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å¤§ããè¡¨ç¤ºã§ãã¾ã™ã€‚
        ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‹ã‚‰åŒã˜ç”»é¢ã‚’åˆ¥ã‚¿ãƒ–ã§é–‹ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚
      </p>

      <div
        id="photo-status"
        class="text-center text-sm text-slate-500 py-6"
      >
        èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦
      </div>

      <div
        id="photo-grid"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"
      ></div>
    </section>

    <!-- å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section id="video-section" class="mb-4 hidden">
      <h2 class="flex items-center gap-2 text-lg md:text-xl font-bold text-slate-900 mb-2">
        <span>ğŸ¥</span>
        <span>å‹•ç”»ä¸€è¦§</span>
      </h2>
      <p class="text-xs md:text-sm text-slate-600 mb-3">
        ã‚µãƒ ãƒã‚¤ãƒ«ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã™ã€‚
        ã€Œâ†“ é–‹ã„ã¦ä¿å­˜ã€ã‚’æŠ¼ã—ã¦é–‹ã„ãŸç”»é¢ã§é•·æŠ¼ã— â†’ ã€Œãƒ“ãƒ‡ã‚ªã‚’ä¿å­˜ã€ãŒå¯èƒ½ã§ã™ã€‚
      </p>

      <div
        id="video-status"
        class="text-center text-sm text-slate-500 py-6"
      >
        èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦
      </div>

      <div
        id="video-grid"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"
      ></div>
    </section>

    <footer class="mt-6 text-center text-xs md:text-sm text-slate-400">
      Â© 2025 å¤šå’Œæ¥½æ¯ã‚³ãƒ³ãƒšå®Ÿè¡Œå§”å“¡ä¼š
    </footer>
  </div>

  <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div
    id="preview-overlay"
    class="fixed inset-0 bg-black/80 z-50 preview-hidden items-center justify-center px-4"
  >
    <button
      id="preview-close"
      class="absolute top-4 right-4 text-white/80 hover:text-white text-2xl font-semibold"
      type="button"
    >
      Ã—
    </button>

    <img
      id="preview-image"
      class="max-h-[80vh] max-w-[92vw] object-contain rounded-xl shadow-2xl border border-white/10 preview-hidden"
      alt="preview"
    />

    <video
      id="preview-video"
      class="max-h-[80vh] max-w-[92vw] rounded-xl shadow-2xl border border-white/10 preview-hidden"
      controls
      playsinline
    ></video>
  </div>

  <script>
    // ====== Cloudinary è¨­å®š ======
    const CLOUD_NAME = "dpef3dzrk";
    const TAG = "tawarahai2025";

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ2å›ç›®ä»¥é™ã®ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚’é«˜é€ŸåŒ–ï¼‰
    let photoCache = null;
    let videoCache = null;

    // DOM å‚ç…§
    const tabPhoto = document.getElementById("tab-photo");
    const tabVideo = document.getElementById("tab-video");
    const photoSection = document.getElementById("photo-section");
    const videoSection = document.getElementById("video-section");
    const photoGrid = document.getElementById("photo-grid");
    const videoGrid = document.getElementById("video-grid");
    const photoStatus = document.getElementById("photo-status");
    const videoStatus = document.getElementById("video-status");

    const previewOverlay = document.getElementById("preview-overlay");
    const previewImage = document.getElementById("preview-image");
    const previewVideo = document.getElementById("preview-video");
    const previewCloseBtn = document.getElementById("preview-close");

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    function escapeHtml(str) {
      if (!str) return "";
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function createImageUrl(publicId) {
      // å¤§ãã‚è¡¨ç¤ºç”¨
      return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/f_auto,q_auto/${publicId}`;
    }

    function createImageThumbUrl(publicId) {
      // æ­£æ–¹å½¢ã‚µãƒ ãƒã‚¤ãƒ«
      return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/c_fill,w_700,h_700,f_auto,q_auto/${publicId}`;
    }

    function createVideoUrl(publicId) {
      // mp4ã§å†ç”Ÿï¼†ä¿å­˜ã—ã‚„ã™ã„ã‚ˆã†ã«
      return `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/f_auto,q_auto/${publicId}.mp4`;
    }

    function createVideoPosterUrl(publicId) {
      // å‹•ç”»ã®1ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ
      return `https://res.cloudinary.com/${CLOUD_NAME}/video/upload/f_auto,q_auto/${publicId}.jpg`;
    }

    function openPreview(kind, url) {
      previewOverlay.classList.remove("preview-hidden");
      previewOverlay.classList.add("flex");

      if (kind === "photo") {
        previewVideo.classList.add("preview-hidden");
        previewVideo.pause();
        previewImage.src = url;
        previewImage.classList.remove("preview-hidden");
      } else {
        previewImage.classList.add("preview-hidden");
        previewImage.src = "";
        previewVideo.src = url;
        previewVideo.classList.remove("preview-hidden");
        previewVideo.play().catch(() => {});
      }
    }

    function closePreview() {
      previewOverlay.classList.add("preview-hidden");
      previewOverlay.classList.remove("flex");
      previewImage.src = "";
      previewVideo.pause();
      previewVideo.src = "";
    }

    previewOverlay.addEventListener("click", (e) => {
      if (e.target === previewOverlay) {
        closePreview();
      }
    });
    previewCloseBtn.addEventListener("click", closePreview);

    // ====== Cloudinary Resource List å–å¾— ======
    async function fetchResources(resourceType) {
      const url = `https://res.cloudinary.com/${CLOUD_NAME}/${resourceType}/list/${TAG}.json`;
      try {
        const res = await fetch(url);
        if (!res.ok) {
          console.warn("Resource list error:", resourceType, res.status);
          return [];
        }
        const data = await res.json();
        return data.resources || [];
      } catch (err) {
        console.error("Fetch error:", resourceType, err);
        return [];
      }
    }

    // ====== å†™çœŸã®æç”» ======
    function renderPhotos(resources) {
      photoGrid.innerHTML = "";

      if (!resources || resources.length === 0) {
        photoStatus.textContent = "ã¾ã å†™çœŸã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        return;
      } else {
        photoStatus.textContent = "";
      }

      resources.forEach((res) => {
        const publicId = res.public_id;
        const ctx = (res.context && res.context.custom) || {};
        const name = ctx.caption || "";
        const comment = ctx.alt || "";

        const originalUrl = createImageUrl(publicId);
        const thumbUrl = createImageThumbUrl(publicId);

        const card = document.createElement("div");
        card.className =
          "bg-white rounded-2xl shadow-sm border border-emerald-100 p-3 flex flex-col gap-2";

        // ã‚µãƒ ãƒã‚¤ãƒ«ãƒœã‚¿ãƒ³
        const thumbBtn = document.createElement("button");
        thumbBtn.type = "button";
        thumbBtn.className =
          "relative w-full pt-[100%] overflow-hidden rounded-xl bg-slate-100";
        const img = document.createElement("img");
        img.src = thumbUrl;
        img.alt = name || "photo";
        img.loading = "lazy";
        img.className =
          "absolute inset-0 w-full h-full object-cover hover:scale-105 transition-transform duration-300";
        thumbBtn.appendChild(img);

        thumbBtn.addEventListener("click", () => {
          openPreview("photo", originalUrl);
        });

        // åå‰ï¼‹ã‚³ãƒ¡ãƒ³ãƒˆ
        const meta = document.createElement("div");
        meta.className = "text-xs text-slate-600";
        const nameEl = document.createElement("div");
        nameEl.className = "font-semibold text-slate-900 truncate";
        nameEl.textContent = name || "ãŠåå‰ãªã—";
        meta.appendChild(nameEl);

        if (comment) {
          const comEl = document.createElement("div");
          comEl.className = "mt-0.5 text-[11px] text-slate-500 whitespace-pre-wrap";
          comEl.innerHTML = escapeHtml(comment);
          meta.appendChild(comEl);
        }

        // ã€Œé–‹ã„ã¦ä¿å­˜ã€ãƒªãƒ³ã‚¯
        const saveLink = document.createElement("a");
        saveLink.href = originalUrl;
        saveLink.target = "_blank";
        saveLink.rel = "noopener";
        saveLink.className =
          "mt-1 inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 text-[11px] font-semibold hover:bg-emerald-100 transition";
        saveLink.textContent = "â†“ é–‹ã„ã¦ä¿å­˜";

        card.appendChild(thumbBtn);
        card.appendChild(meta);
        card.appendChild(saveLink);

        photoGrid.appendChild(card);
      });
    }

    // ====== å‹•ç”»ã®æç”» ======
    function renderVideos(resources) {
      videoGrid.innerHTML = "";

      if (!resources || resources.length === 0) {
        videoStatus.textContent = "ã¾ã å‹•ç”»ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚";
        return;
      } else {
        videoStatus.textContent = "";
      }

      resources.forEach((res) => {
        const publicId = res.public_id;
        const ctx = (res.context && res.context.custom) || {};
        const name = ctx.caption || "";
        const comment = ctx.alt || "";

        const videoUrl = createVideoUrl(publicId);
        const posterUrl = createVideoPosterUrl(publicId);

        const card = document.createElement("div");
        card.className =
          "bg-white rounded-2xl shadow-sm border border-emerald-100 p-3 flex flex-col gap-2";

        // ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆç”»åƒï¼‰ï¼‹ å†ç”Ÿã‚¢ã‚¤ã‚³ãƒ³
        const thumbBtn = document.createElement("button");
        thumbBtn.type = "button";
        thumbBtn.className =
          "relative w-full pt-[100%] overflow-hidden rounded-xl bg-slate-100";

        const img = document.createElement("img");
        img.src = posterUrl;
        img.alt = name || "video";
        img.loading = "lazy";
        img.className =
          "absolute inset-0 w-full h-full object-cover hover:scale-105 transition-transform duration-300";

        const playBadge = document.createElement("div");
        playBadge.className =
          "absolute inset-0 flex items-center justify-center";
        playBadge.innerHTML =
          '<div class="w-12 h-12 rounded-full bg-black/70 flex items-center justify-center text-white text-xl">&#9654;</div>';

        thumbBtn.appendChild(img);
        thumbBtn.appendChild(playBadge);

        thumbBtn.addEventListener("click", () => {
          openPreview("video", videoUrl);
        });

        // åå‰ï¼‹ã‚³ãƒ¡ãƒ³ãƒˆ
        const meta = document.createElement("div");
        meta.className = "text-xs text-slate-600";
        const nameEl = document.createElement("div");
        nameEl.className = "font-semibold text-slate-900 truncate";
        nameEl.textContent = name || "ãŠåå‰ãªã—";
        meta.appendChild(nameEl);

        if (comment) {
          const comEl = document.createElement("div");
          comEl.className = "mt-0.5 text-[11px] text-slate-500 whitespace-pre-wrap";
          comEl.innerHTML = escapeHtml(comment);
          meta.appendChild(comEl);
        }

        // ã€Œé–‹ã„ã¦ä¿å­˜ã€ãƒªãƒ³ã‚¯
        const saveLink = document.createElement("a");
        saveLink.href = videoUrl;
        saveLink.target = "_blank";
        saveLink.rel = "noopener";
        saveLink.className =
          "mt-1 inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 text-[11px] font-semibold hover:bg-emerald-100 transition";
        saveLink.textContent = "â†“ é–‹ã„ã¦ä¿å­˜";

        card.appendChild(thumbBtn);
        card.appendChild(meta);
        card.appendChild(saveLink);

        videoGrid.appendChild(card);
      });
    }

    // ====== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ======
    async function showPhotoTab() {
      tabPhoto.classList.add("bg-emerald-500", "text-white", "shadow");
      tabPhoto.classList.remove("text-emerald-700");
      tabVideo.classList.remove("bg-emerald-500", "text-white", "shadow");
      tabVideo.classList.add("text-emerald-700");

      photoSection.classList.remove("hidden");
      videoSection.classList.add("hidden");

      if (!photoCache) {
        photoStatus.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
        const res = await fetchResources("image");
        photoCache = res;
        renderPhotos(photoCache);
      }
    }

    async function showVideoTab() {
      tabVideo.classList.add("bg-emerald-500", "text-white", "shadow");
      tabVideo.classList.remove("text-emerald-700");
      tabPhoto.classList.remove("bg-emerald-500", "text-white", "shadow");
      tabPhoto.classList.add("text-emerald-700");

      videoSection.classList.remove("hidden");
      photoSection.classList.add("hidden");

      if (!videoCache) {
        videoStatus.textContent = "èª­ã¿è¾¼ã¿ä¸­ã§ã™â€¦";
        const res = await fetchResources("video");
        videoCache = res;
        renderVideos(videoCache);
      }
    }

    tabPhoto.addEventListener("click", showPhotoTab);
    tabVideo.addEventListener("click", showVideoTab);

    // åˆæœŸè¡¨ç¤ºã¯å†™çœŸã‚¿ãƒ–
    (async () => {
      await showPhotoTab();
    })();
  </script>
</body>
</html>
